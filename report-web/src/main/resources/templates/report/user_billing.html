<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/layout}">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <script type="text/javascript" src="../../META-INF/resources/webjars/jquery/3.2.0/jquery.js" th:remove="all"></script>
</head>
<body>
<div layout:fragment="screen_content" id="table_content">
    <ol class="breadcrumb">
        <li><strong><span style="color: #27a0d7">用户对账单统计</span></strong></li>
    </ol>
    <form class="form-inline" role="form" style="float: left;" method="post" id="queryForm">
        <div class="form-group">
            <label >用户ID:</label>
            <input type="text" class="form-control layer-date" id="userId" name="userId">
        </div>
        <div class="form-group">
            <label >统计时间:</label>
            <input placeholder="开始时间" class="form-control layer-date" id="startTime" name="startTime">-
            <input placeholder="结束时间" class="form-control layer-date" id="endTime" name="endTime">
        </div>
        <div class="form-group">
            <button type="button" id="queryBtn" th:onclick="|doQuery();|" class="btn btn-primary">查询</button>
        </div>
    </form>
    <table id="table"
           data-toolbar="#toolbar"
           data-show-refresh="true"
           data-show-toggle="true"
           data-show-columns="true"
           data-show-export="true"
           data-detail-view="true"
           data-detail-formatter="detailFormatter"
           data-minimum-count-columns="2"
           data-show-pagination-switch="true"
           data-pagination="true"
           data-id-field="id"
           data-show-footer="false"
           th:data-url="${#tools.reportDomain()}+'/reportdata/userbildingquery'"
           data-side-pagination="server">
        <thead>
        <tr>
            <th data-field="userId">用户ID</th>
            <th data-field="serviceId" data-switchable="false">API接口ID</th>
            <th data-field="totalCount">请求次数</th>
            <th data-field="successCount">成功次数</th>
        </tr>
        </thead>
    </table>
    
    <script th:inline="javascript">
        $(function () {
            dateTimepickerinit($('#startTime'),$('#endTime'));
        });

        // 要求重写次方法，请求服务器数据入参方法,参数可自定义
        function queryParams(params) {
            var param = {
                startDate : $("#startTime").val(),
                endDate : $("#endTime").val(),
                userId : $("#userId").val(),
                pageindex : this.pageNumber,
                pageSize : this.pageSize
            }
            return param;
        }
        /**
         * 初始化时间控件
         * @param startTime
         * @param endTime
         */
        function dateTimepickerinit(startTime,endTime) {
            startTime.datetimepicker({
                format: 'yyyy-mm-dd 00:00:00',
                minView:'month',
                language: 'zh-CN',
                clearBtn:true,// 自定义属性,true 显示 清空按钮 false 隐藏 默认:true
                autoclose:true
                // startDate:new Date()
            }).on("click",function(){
                startTime.datetimepicker("setEndDate",endTime.val());
            });
            endTime.datetimepicker({
                format: 'yyyy-mm-dd 23:59:59',
                minView:'month',
                language: 'zh-CN',
                clearBtn:true,// 自定义属性,true 显示 清空按钮 false 隐藏 默认:true
                autoclose:true
                // startDate:new Date()
            }).on("click",function(){
                endTime.datetimepicker("setStartDate",startTime.val());
            });
        }
        function detailFormatter(index, row) {
        	$.ajax({
                url:[[${#tools.reportDomain()}]] + "/reportdata/userbildingdetailquery",
                data:{},
                dataType:'html',
                type:'post',
                async:true,
                crossDomain: true,
                xhrFields: {
                    withCredentials: true
                },
                success:function (data) {
                    $("#detailListDiv").html(data);
                }
            })
            var html = [];
            $.each(row, function (key, value) {
                html.push('<p><b>' + key + ':</b> ' + value + '</p>');
            });
            return html.join('');
        }
    </script>
	<!-- Tab panes -->
	<div class="tab-content pt15" id="detailListDiv" style="visibility: hidden;">
		<div role="tabpanel" class="tab-pane active" id="staffList">
    <table id="table_detail">
        <thead>
        <tr>
            <th >用户ID</th>
            <th >请求流水号</th>
            <th >API接口ID</th>
            <th >请求时间</th>
            <th >计费金额</th>
        </tr>
        </thead>
        <tbody th:if="${pageInfo} and ${pageInfo.list}">
          <tr th:each="detailVO,detailStat:${pageInfo.list}">
              <td th:text="${detailVO.userId}"></td>
              <td th:text="${detailVO.usedId}"></td>
              <td th:text="${detailVO.serviceId}"></td>
              <td th:text="${#dates.format(detailVO.createTime, 'yyyy-MM-dd  HH:mm:ss')}"></td>
              <td th:text="${#tools.formatLiToMoneyClean(detailVO.unitPrice)}"></td>
          </tr>
        </tbody>
    </table>
    <div class="pagelist" th:remove="all" >
		<nav aria-label="Page navigation">
		  <ul class="pagination">
			<li >
			  <a href="#" aria-label="Previous">
				<span aria-hidden="true">上一页</span>
			  </a>
			</li>
			<li class="active"><a href="#">1</a></li>
			<li><a href="#">2</a></li>
			<li><a href="#">3</a></li>
			<li><a href="#">4</a></li>
			<li><a href="#">5</a></li>
			<li>
			  <a href="#" aria-label="Next">
				<span aria-hidden="true">下一页</span>
			  </a>
			</li>
			<div class="pageskip">
			<span class="pr10">到第<input type="text" class="pageskip_box">页</span>
			<a href="" class="btn btn-default  btn_rec btn-sm">确定</a>
		  </div>
		  </ul>

		</nav>
	</div>
	</div>
	</div>

</div>

</body>
</html>